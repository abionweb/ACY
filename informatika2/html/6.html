<html>
<head>
</head>
<body>
<h1>Файловые функции VBA, Input(), FileLen(), EOF(), LOF(), Loc()</h1>

<p>В VBA предусмотрен набор встроенных функций для выполнения различных операций с файлами, каталогами, дисками и прочими объектами файловой системы. Информация об этих функциях приведена ниже. Но не забывайте, что помимо этих возможностей (общих для всех приложений, в которых используется VBA) у нас есть также, во-первых, возможности, специфические для данного приложения (например, открытие и сохранение документа Word средствами объектной модели Word). Во-вторых, на любом компьютере под управлением Windows есть объектная библиотека под названием Microsoft Scripting Runtime — очень простая и очень удобная для выполнения различных операций с файлами, каталогами и дисками. Можно добавить в проект VBA на нее ссылку и использовать все имеющиеся в ней возможности. Если, к примеру, мне нужно пройти по всем файлам в данном каталоге и что-нибудь с ними сделать (например, загрузить в Excel все файлы отчетов, которые пришли из филиалов), я использую именно эту библиотеку. Справку по ней можно найти на сайте Microsoft (www.microsoft.com/scripting).</p>

<p>А это — встроенные функции для работой с файловой системой, предусмотренные в VBA:</p>

<p>CurDir() — функция, которая возвращает путь к текущему каталогу, в котором будут сохраняться файлы нашего приложения по умолчанию.</p>
<p>Dir() — позволяет искать файл или каталог по указанному пути на диске.</p>
<p>EOF() — при операции записи в файл на диске эту функция вернет True, если вы находитесь в конце файла. Используется при записи в файл своего собственного формата. При сохранении документов Word, книг Excel и т.п. лучше использовать стандартные методы объектов этих документов: Save и SaveAs().</p>
<p>Error() — позволяет вернуть описание ошибки по ее номеру. Генерировать ошибку нужно при помощи метода RaiseError() специального объекта Err (см. главу 6, в которой рассказывается про перехват ошибок и отладку).</p>
<p>FileAttr() — позволяет определить, как именно был открыт вами файл в файловой системе: на чтение, запись, добавление, в двоичном или текстовом режиме и т.п.</p>
<p>FileDateTime() — позволяет получить информацию о последнем времени обращения к указанному вами файлу. Если к файлу после создания ни разу не обращались, то это будет время создания файла.</p>
<p>FileLen() — позволяет определить длину указанного вами файла в байтах.</p>
<p>FreeFile() — позволяет определить следующую свободную цифру, которую можно использовать как номер файла при его открытии.</p>
<p>GetAttr() — возможность обратиться к файлу к файловой системе и получить информацию об его атрибутах (скрытый, доступен только для чтения, архивный и т.п.)</p>
<p>Input() — позволяет считать информацию из открытого файла. Например, считать информацию из файла C:\text1.txt и вывести ее в окно Immediate можно так:</p>
<p>Dim MyChar</p>

<pre>Open " c:\text1.txt" For Input As #1 'Открываем файл функцией Open() на чтение

Do While Not EOF(1) 'пока файл не кончился

' Получаем по одному символу и добавляем его к предыдущим

MyChar = MyChar & Input(1, #1)

Loop

Close #1 ' Закрываем файл

Debug . Print MyChar 'Выводим его содержание в окно Immediate</pre>

<p>Вариант этой функции — InputB() позволяет указывать количество байт, которые надо скачать из файла.</p>
<p>Loc() — от Location, то есть местонахождение — возвращает число, которое определяет текущее место вставки или чтения в открытом файле. Похоже работает функция Seek(), но она возвращает информацию о позиции, с которой будет выполняться следующая операция чтения или вставки.</p>
<p>LOF() — от length of file — позволяет определить длину открытого файла в байтах.</p>

</body>
</html>